<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>最終關卡首頁(前台)</title>
	<link rel="stylesheet" href="./styles/all.css">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.18/c3.css">

</head>

<body>
	<nav class="topBar">
		<div class="wrap">
			<h1>
				<a href="#" class="logo">WOWOROOM</a>
			</h1>
			<span class="material-icons menuToggle">
				menu
			</span>
			<ul class="topBar-menu">
				<li>
					<a href="#bedAdvantage">床墊優勢</a>
				</li>
				<li>
					<a href="#recommendation">好評推薦</a>
				</li>
				<li>
					<a href="#transport">運送方式</a>
				</li>
				<li>
					<a href="#orderInfo">立即預訂</a>
				</li>
			</ul>
		</div>
	</nav>
	<section class="wrap" id="bedAdvantage">
		<div class="banner">
			<h2 class="banner-text">窩窩家居<br>跟您一起品味生活</h2>
		</div>
		<h3 class="section-title">床墊優勢</h3>
		<ul class="bedAdvantage">
			<li>
				<img class="bedAdvantage-img" src="./images/tR426y5.png" alt="原木料環保">
				<p class="bedAdvantage-text">原木料環保</p>
			</li>
			<li>
				<img class="bedAdvantage-img" src="./images/Fd2MiBb.png" alt="好收納">
				<p class="bedAdvantage-text">好收納</p>
			</li>
			<li>
				<img class="bedAdvantage-img" src="./images/5n1uTFh.png" alt="好組裝">
				<p class="bedAdvantage-text">好組裝</p>
			</li>
		</ul>
	</section>
	<section class="furniture-compare">
		<div class="wrap">
			<h3 class="section-title">家具比較</h3>
			<div class="overflowWrap">
				<table class="compare-table">
					<thead>
						<tr>
							<th></th>
							<th>窩窩系統模組家具</th>
							<th class="text-muted">組合式家具</th>
							<th class="text-muted">實木家具</th>
						</tr>
					</thead>
					<tr>
						<td>可單人自行組裝</td>
						<td>
							<span class="material-icons">done</span>
						</td>
						<td class="text-muted">不一定</td>
						<td></td>
					</tr>
					<tr>
						<td>可多次重複拆裝</td>
						<td>
							<span class="material-icons">done</span>
						</td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>床墊規格彈性大</td>
						<td>
							<span class="material-icons">done</span>
						</td>
						<td class="text-muted">不一定</td>
						<td class="text-muted">不一定</td>
					</tr>
					<tr>
						<td>材質可長久使用</td>
						<td>
							<span class="material-icons">done</span>
						</td>
						<td></td>
						<td>
							<span class="material-icons">done</span>
						</td>
					</tr>
					<tr>
						<td>小客車即可搬運</td>
						<td>
							<span class="material-icons">done</span>
						</td>
						<td></td>
						<td></td>
					</tr>
				</table>
			</div>
		</div>
	</section>
	<section class="recommendation" id="recommendation">
		<div class="wrap">
			<h3 class="section-title">好評推薦</h3>
			<div class="recommendation-wall">
				<ul class="gallery-top">
					<li class="recommendation-card">
						<img src="./images/cXcOLhu.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/I9L7WOr.png" alt="">
								<div>
									<p>王六角</p>
									<p class="recommend-text">Jodan 雙人床架</p>
								</div>
							</div>
							<p>CP值很高。</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/BefHmH2.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/CUFGfay.png" alt="">
								<div>
									<p>Leaf</p>
									<p class="recommend-text">Antony 雙人床架</p>
								</div>
							</div>
							<p>很喜歡～還有送三年保固～</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/3IATkJG.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/8WwZsLS.png" alt="">
								<div>
									<p>美濃鄧子琪</p>
									<p class="recommend-text">Charles 系列儲物組合</p>
								</div>
							</div>
							<p>廚房必備美用品！</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/HvT3zlU.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/NycuPVy.png" alt="">
								<div>
									<p>isRaynotArray</p>
									<p class="recommend-text">Antony 雙人床架</p>
								</div>
							</div>
							<p>物超所值!</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/Ed7bxLr.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/zdFOQIv.png" alt="">
								<div>
									<p>程鮭魚</p>
									<p class="recommend-text">Louvre 雙人床架</p>
								</div>
							</div>
							<p>租屋用剛剛好</p>
						</div>
					</li>
				</ul>
				<ul class="gallery-bottom">
					<li class="recommendation-card">
						<img src="./images/BefHmH2.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/W7fyzp2.png" alt="">
								<div>
									<p>小杰</p>
									<p class="recommend-text">Louvre 雙人床架</p>
								</div>
							</div>
							<p>非常舒適，有需要會再回購</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/mjA01Tk.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/8O1cOnG.png" alt="">
								<div>
									<p>江八角</p>
									<p class="recommend-text">Charles 雙人床架</p>
								</div>
							</div>
							<p>品質不錯～</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/npA3DgP.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/C0NDvSA.png" alt="">
								<div>
									<p>juni讚神</p>
									<p class="recommend-text">Antony 床邊桌</p>
								</div>
							</div>
							<p>讚ㄉ！</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/Ed7bxLr.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/hUsTZDm.png" alt="">
								<div>
									<p>久安說安安</p>
									<p class="recommend-text">Antony 單人床架</p>
								</div>
							</div>
							<p>一個躺剛剛好。</p>
						</div>
					</li>
					<li class="recommendation-card">
						<img src="./images/mjA01Tk.png" alt="">
						<div class="recommend-content">
							<div class="recommend-img">
								<img src="./images/3ako6QX.png" alt="">
								<div>
									<p>PeiQun</p>
									<p class="recommend-text">Antony 雙人床架</p>
								</div>
							</div>
							<p>睡起來很舒適</p>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</section>
	<section class="transport" id="transport">
		<h3 class="section-title">運送方式</h3>
		<ul class="transport-intro">
			<li class="transport-card">
				<div class="cardImg">
					<span class="material-icons">
						shopping_cart
					</span>
				</div>
				<h4>STEP.1</h4>
				<p>選購商品</p>
			</li>
			<li class="transport-card">
				<div class="cardImg">
					<span class="material-icons">
						format_list_bulleted
					</span>
				</div>
				<h4>STEP.2</h4>
				<p>填寫預定資料</p>
			</li>
			<li class="transport-card">
				<div class="cardImg">
					<span class="material-icons">
						done
					</span>
				</div>
				<h4>STEP.3</h4>
				<p>預定成功</p>
			</li>
			<li class="transport-card">
				<div class="cardImg">
					<span class="material-icons">
						local_post_office
					</span>
				</div>
				<h4>STEP.4</h4>
				<p>Email 付款資訊</p>
			</li>
		</ul>
	</section>
	<section class="wrap productDisplay">
		<select name="" class="productSelect">
			<option value="全部" selected>全部</option>
			<option value="床架">床架</option>
			<option value="收納">收納</option>
			<option value="窗簾">窗簾</option>
		</select>
		<ul class="productList"></ul>
	</section>
	<section class="shoppingCart">
		<h3 class="section-title">我的購物車</h3>
		<div class="overflowWrap">
			<table class="shoppingCart-table">
				<thead>
					<tr>
						<th width="40%">品項</th>
						<th width="15%">單價</th>
						<th width="15%">數量</th>
						<th width="15%">金額</th>
						<th width="15%"></th>
					</tr>
				</thead>
				<tbody class="cartList"></tbody>
				<tr>
					<td>
						<a href="#" class="discardAllBtn">刪除所有品項</a>
					</td>
					<td></td>
					<td></td>
					<td>
						<p>總金額</p>
					</td>
					<td>NT$13,980</td>
				</tr>
			</table>
		</div>
	</section>
	<section class="orderInfo wrap" id="orderInfo">
		<h3 class="section-title">填寫預訂資料</h3>
		<form action="" class="orderInfo-form">
			<div class="orderInfo-formGroup">
				<label for="customerName" class="orderInfo-label">姓名</label>
				<div class="orderInfo-inputWrap">
					<input type="text" class="orderInfo-input customerName" id="customerName" placeholder="請輸入姓名"
						name="姓名">
					<p class="orderInfo-message" data-message="姓名">必填</p>
				</div>
			</div>
			<div class="orderInfo-formGroup">
				<label for="customerPhone" class="orderInfo-label">電話</label>
				<div class="orderInfo-inputWrap">
					<input type="tel" class="orderInfo-input customerPhone" id="customerPhone" placeholder="請輸入電話"
						name="電話">
					<p class="orderInfo-message" data-message="電話">必填</p>
				</div>
			</div>
			<div class="orderInfo-formGroup">
				<label for="customerEmail" class="orderInfo-label">Email</label>
				<div class="orderInfo-inputWrap">
					<input type="email" class="orderInfo-input customerEmail" id="customerEmail" placeholder="請輸入 Email"
						name="Email">
					<p class="orderInfo-message" data-message="Email">必填</p>
				</div>
			</div>
			<div class="orderInfo-formGroup">
				<label for="customerAddress" class="orderInfo-label">寄送地址</label>
				<div class="orderInfo-inputWrap">
					<input type="text" class="orderInfo-input customerAddress" id="customerAddress"
						placeholder="請輸入寄送地址" name="寄送地址">
					<p class="orderInfo-message" data-message="寄送地址">必填</p>
				</div>
			</div>
			<div class="orderInfo-formGroup">
				<label for="tradeWay" class="orderInfo-label">交易方式</label>
				<div class="orderInfo-inputWrap">
					<select id="tradeWay" class="orderInfo-input tradeWay" name="交易方式">
						<option value="ATM" selected>ATM</option>
						<option value="信用卡">信用卡</option>
						<option value="超商付款">超商付款</option>
					</select>
				</div>
			</div>
			<input type="button" value="送出預訂資料" class="orderInfo-btn">
		</form>
	</section>
	<!-- axios -->
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

	<script>
		// 請代入自己的網址路徑
		const api_path = "shcopy";
		const token = "BsWEOCfIMrRpL8sIFGZUFLQ7BYH3";

		// DOM
		const productList = document.querySelector(".productList");
		const cartList = document.querySelector(".cartList");
		const productSelect = document.querySelector('.productSelect');
		const discardAllBtn = document.querySelector('.discardAllBtn');

		let productData = [];
		let cartData = [];

		// 資料初始化
		function init() {
			getProductList(); // 取得產品列表
			getCartList();    // 取得購物車列表
		}
		init();

		// 取得產品列表
		function getProductList() {
			axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/products`)
				.then(function (response) {
					productData = response.data.products;
					renderProductList();
				}).catch(function (error) {
					console.log(error.response.data)
				})
		}

		function renderProductList() {
			let str = "";
			productData.forEach(function (item) {
				str += `<li class="productCard">`;
				str += `<h4 class="productType">${item.category}</h4>`;
				str += `<img src="${item.images}" alt="">`;
				str += `<a href="#" class="addCardBtn" data-id="${item.id}">加入購物車</a>`;
				str += `<h3>${item.title}</h3>`;
				str += `<del class="originPrice">NT$${item.origin_price}</del>`;
				str += `<p class="nowPrice">NT$${item.price}</p>`;
				str += `</li>`;
			});
			productList.innerHTML = str;
		}

		productSelect.addEventListener('change', function (e) {
			let category = e.target.value;
			if (category == "全部") {
				renderProductList();
				return;
			}
			let str = "";
			productData.forEach(function (item) {
				if (item.category == category) {
					str += `<li class="productCard">`;
					str += `<h4 class="productType">${item.category}</h4>`;
					str += `<img src="${item.images}" alt="">`;
					str += `<a href="" class="addCardBtn" data-id="${item.id}">加入購物車</a>`;
					str += `<h3>${item.title}</h3>`;
					str += `<del class="originPrice">NT$${item.origin_price}</del>`;
					str += `<p class="nowPrice">NT$${item.price}</p>`;
					str += `</li>`;
				}
			})
			productList.innerHTML = str;
		})

		function renderCartList() {
			let str = "";
			cartData.forEach(function (item) {
				str += `<tr>`;
				str += `<td>`;
				str += `<div class="cardItem-title">`;
				str += `<img src="${item.product.images}" alt="">`;
				str += `<p>${item.product.title}</p>`;
				str += `</div>`;
				str += `</td>`;
				str += `<td>NT$${item.product.origin_price}</td>`;
				str += `<td>${item.quantity}</td>`;
				str += `<td>NT$${item.product.price}</td>`;
				str += `<td class="discardBtn"><a href="#" class="material-icons" data-id="${item.id}">clear</a></td>`;
				str += `</tr>`;
			});
			cartList.innerHTML = str;
		}

		// 取得購物車列表
		function getCartList() {
			axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts`)
				.then(function (response) {
					cartData = response.data.carts;
					renderCartList();

				}).catch(function (error) {
					console.log(error.response.data)
				})
		}

		// 加入購物車
		productList.addEventListener('click', function (e) {
			let addCartClass = e.target.getAttribute("class");
			if (addCartClass !== "addCardBtn") {
				return;
			}
			let productId = e.target.getAttribute("data-id");
			addCartItem(productId);
		})

		function addCartItem(id) {
			let numCheck = 1;
			cartData.forEach(function (item) {
				if (item.product.id === id) {
					numCheck = item.quantity += 1;
				}
			});

			axios.post(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts`, {
				data: {
					"productId": id,
					"quantity": numCheck
				}
			}).then(function (response) {
				alert("加入購物車成功");
				getCartList();
			})
		}

		// 刪除購物車內特定產品 --------> 待完成
		cartList.addEventListener('click', function (e) {
			let cartId = e.target.getAttribute('data-id');
			if (cartId == null) {
				return;
			}
			deleteCartItem(cartId);
		});

		function deleteCartItem(cartId) {
			axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts/${cartId}`)
				.then(function (response) {
					alert('刪除單筆購物車產品成功');
					getCartList();
				})
		}

		// 清除購物車內全部產品
		discardAllBtn.addEventListener('click', function (e) {
			deleteAllCartList();
		});

		function deleteAllCartList() {
			axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/carts`)
				.then(function (response) {
					alert("刪除全部購物車產品成功");
					getCartList();
				}).catch(function () {
					alert("購物車已清空，請勿重複點擊！");
				});
		}

		const orderInfobtn = document.querySelector('.orderInfo-btn');
		orderInfobtn.addEventListener('click', function (e) {
			let carthLength = document.querySelectorAll(".cartList tr").length;
			if (carthLength == 0) {
				alert("請加入至少一個購物車品項！");
				return;
			}

			let customerName = document.querySelector('.customerName').value;
			let customerPhone = document.querySelector('.customerPhone').value;
			let customerEmail = document.querySelector('.customerEmail').value;
			let customerAddress = document.querySelector('.customerAddress').value;
			let tradeWay = document.querySelector('.tradeWay').value;

			if (customerName == "" || customerPhone == "" || customerEmail == "" || customerAddress == "" || tradeWay == "") {
				alert("請輸入訂單資訊！");
				return;
			}

			let data = {
				"name": customerName,
				"tel": customerPhone,
				"email": customerEmail,
				"address": customerAddress,
				"payment": tradeWay
			}

			createOrder(data);
		});

		// 送出購買訂單
		function createOrder(item) {
			axios.post(`https://livejs-api.hexschool.io/api/livejs/v1/customer/${api_path}/orders`, {
				"data": {
					"user": {
						"name": item.name,
						"tel": item.tel,
						"email": item.email,
						"address": item.address,
						"payment": item.payment
					}
				}
			}).then(function (response) {
				//console.log(response.data);
				alert("訂單建立成功!")
				getCartList();
			}).catch(function (error) {
				console.log(error.response.data);
			})
		}

		// 取得訂單列表
		/*
		function getOrderList() {
			axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, {
				headers: {
					'Authorization': token
				}
			}).then(function (response) {
				console.log(response.data);
			})
		}
		*/

		// 修改訂單狀態
		/*
		function editOrderList(orderId) {
			axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, {
				"data": {
					"id": orderId,
					"paid": true
				}
			}, {
				headers: {
					'Authorization': token
				}
			}).then(function (response) {
				console.log(response.data);
			})
		}
		*/

		// 刪除全部訂單
		/*
		function deleteAllOrder() {
			axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, {
				headers: {
					'Authorization': token
				}
			}).then(function (response) {
				// console.log(response.data);
			})
		}
		*/

		// 刪除特定訂單
		/*
		function deleteOrderItem(orderId) {
			axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${orderId}`, {
				headers: {
					'Authorization': token
				}
			}).then(function (response) {
				console.log(response.data);
			})
		}
		*/
	</script>
	<!-- 預設 JS，請同學不要修改此處 -->
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const ele = document.querySelector('.recommendation-wall');
			ele.style.cursor = 'grab';
			let pos = {
				top: 0,
				left: 0,
				x: 0,
				y: 0
			};
			const mouseDownHandler = function (e) {
				ele.style.cursor = 'grabbing';
				ele.style.userSelect = 'none';

				pos = {
					left: ele.scrollLeft,
					top: ele.scrollTop,
					// Get the current mouse position
					x: e.clientX,
					y: e.clientY
				};

				document.addEventListener('mousemove', mouseMoveHandler);
				document.addEventListener('mouseup', mouseUpHandler);
			};
			const mouseMoveHandler = function (e) { // How far the mouse has been moved
				const dx = e.clientX - pos.x;
				const dy = e.clientY - pos.y;

				// Scroll the element
				ele.scrollTop = pos.top - dy;
				ele.scrollLeft = pos.left - dx;
			};
			const mouseUpHandler = function () {
				ele.style.cursor = 'grab';
				ele.style.removeProperty('user-select');

				document.removeEventListener('mousemove', mouseMoveHandler);
				document.removeEventListener('mouseup', mouseUpHandler);
			};
			// Attach the handler
			ele.addEventListener('mousedown', mouseDownHandler);
		});
		// menu 切換
		let menuOpenBtn = document.querySelector('.menuToggle');
		let linkBtn = document.querySelectorAll('.topBar-menu a');
		let menu = document.querySelector('.topBar-menu');
		menuOpenBtn.addEventListener('click', menuToggle);

		linkBtn.forEach((item) => {
			item.addEventListener('click', closeMenu);
		})

		function menuToggle() {
			if (menu.classList.contains('openMenu')) {
				menu.classList.remove('openMenu');
			} else {
				menu.classList.add('openMenu');
			}
		}
		function closeMenu() {
			menu.classList.remove('openMenu');
		}
	</script>
</body>

</html>